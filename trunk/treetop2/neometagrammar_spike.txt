rule expression
  choice / sequence / primary
end

rule choice
  alternative (space? '/' space? alternative)+
end

rule sequence
  primary (space primary)+ trailing_block
end

rule primary
  instantiator_primary trailing_block
  /
  propagator_primary
end

rule instantiator_primary
  atomic repetition_suffix / atomic_instantiator
end

rule propagator_primary
  prefix primary
  /
  (instantiator_primary / atomic) '?'
  /
  atomic_propagator
end

rule atomic
  atomic_instantiator / atomic_propagator
end

rule atomic_instantiator
  terminal
  /
  parenthesized_instantiator
end

rule atomic_propagator
  nonterminal
  /
  parenthesized_propagator
end

rule parenthesized_propagator
  '(' space? propagator space? ')'
end

rule parenthesized_instantiator
  '(' space? instantiator space? ')'
end

rule propagator
  choice / propagator_primary
end

rule instantiator
  sequence / instantiator_primary
end

rule alternative
  sequence / primary
end

rule repetition_suffix
  '+' / '*'
end